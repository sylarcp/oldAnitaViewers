/* Functions for calibration of SURF channel RF power used by TrigMon and 
 * SlowMo programs
 */
#include <math.h>
#include "rfpower_cal.h"
#define N_SURF 12//peng
//#define N_SURF 10
#define RFCHAN 8
#define N_DBM  10
/*
float dbm[N_DBM]={-45,-40,-35,-30,-25,-20,-15,-10,-5,0};
float a_temp_old[N_SURF][RFCHAN]={
{0.0393523,0.0393523,0.0387606,0.0390542,0.0399624,0.0412412,0.0405918,0.0405918},
{0.0387606,0.0409139,0.0381863,0.0393523,0.0409139,0.0409139,0.0412412,0.039655},
{0.0399624,0.0405918,0.0387606,0.0381863,0.0415738,0.0399624,0.0440612,0.0405918},
{0.0399624,0.0399624,0.0387606,0.0384713,0.0409139,0.0405918,0.0409139,0.0399624},
{0.0373562,0.044441,0.0381863,0.0456208,0.0409139,0.0387606,0.0409139,0.0399624},
{0.0393523,0.039655,0.0390542,0.0393523,0.0409139,0.0402746,0.0405918,0.0409139},
{0.0393523,0.0393523,0.0387606,0.0399624,0.039655,0.0419118,0.0409139,0.0409139},
{0.0409139,0.039655,0.0384713,0.0399624,0.0409139,0.0433206,0.0415738,0.0433206},
{0.0363039,0.0464428,0.0399624,0.0393523,0.0422554,0.0422554,0.0429596,0.0429596},
{0.0384713,0.0390542,0.0399624,0.0381863,0.0415738,0.0412412,0.0426046,0.0405918},
{0.0384713,0.0390542,0.0399624,0.0381863,0.0415738,0.0412412,0.0426046,0.0405918},//peng
{0.0384713,0.0390542,0.0399624,0.0381863,0.0415738,0.0412412,0.0426046,0.0405918}//peng
};
/////////////////////////////Dec16 2008/////////////////
float a_temp[N_SURF][RFCHAN]={
{0.0393523,0.0393523,0.0387606,0.0390542,0.0399624,0.0412412,0.0405918,0.0405918},
{0.0387606,0.0409139,0.0381863,0.0393523,0.0409139,0.0409139,0.0412412,0.039655},
{0.0399624,0.0405918,0.0387606,0.0381863,0.0415738,0.0399624,0.0440612,0.0405918},
{0.0399624,0.0399624,0.0387606,0.0384713,0.0409139,0.0405918,0.0409139,0.0399624},
{0.0373562,0.044441,0.0381863,0.0456208,0.0409139,0.0387606,0.0409139,0.0399624},
{0.0393523,0.039655,0.0390542,0.0393523,0.0409139,0.0402746,0.0405918,0.0409139},
{0.0393523,0.0393523,0.0387606,0.0399624,0.039655,0.0419118,0.0409139,0.0409139},
{0.0409139,0.039655,0.0384713,0.0399624,0.0409139,0.0433206,0.0415738,0.0433206},
{0.0363039,0.0464428,0.0399624,0.0393523,0.0422554,0.0422554,0.0429596,0.0429596},
{0.0384713,0.0390542,0.0399624,0.0381863,0.0415738,0.0412412,0.0426046,0.0405918},
{0.0384713,0.0390542,0.0399624,0.0381863,0.0415738,0.0412412,0.0426046,0.0405918},//peng
{0.0384713,0.0390542,0.0399624,0.0381863,0.0415738,0.0412412,0.0426046,0.0405918}//peng
};
// Calibrations performed by Jeff Kowalski, data processed by Shige Matsuno
float rfcal[N_SURF][RFCHAN][N_DBM]={
  {{401.98,405.84,410.86,431.75,504.87,623.13,740.43,870.91,1005.88,1128.85},
   {398.33,399.94,403.12,426.21,498.73,615.66,734.57,864.62,1000.40,1124.38},
   {393.32,402.02,409.06,430.81,508.44,626.90,743.99,873.33,1006.95,1128.41},
   {406.26,410.15,417.81,446.34,512.51,630.51,751.25,880.76,1013.87,1137.76},
   {387.96,388.65,403.23,419.85,500.18,620.28,741.11,873.81,1011.17,1135.58},
   {396.26,396.57,410.22,431.21,503.10,620.96,741.21,871.18,1005.66,1129.38},
   {403.85,404.46,416.60,438.90,517.90,639.35,759.56,890.83,1024.14,1146.95},
   {404.73,413.75,414.81,441.54,519.72,639.58,760.81,893.10,1030.81,1156.30}},
  {{398.40,401.38,408.14,429.12,506.46,626.73,746.30,876.33,1010.30,1129.50},
   {390.52,392.59,399.15,419.99,492.08,608.86,727.56,856.50,990.91,1110.11},
   {386.81,393.97,395.40,422.84,503.42,623.25,742.11,873.17,1007.57,1127.38},
   {392.70,390.26,395.70,428.48,510.15,630.30,749.96,881.73,1016.19,1136.19},
   {393.23,395.95,403.31,428.03,507.46,629.26,749.70,883.65,1020.36,1142.66},
   {385.80,385.13,396.92,419.84,499.63,619.95,739.78,870.99,1005.50,1126.03},
   {393.22,393.85,397.50,430.05,511.78,631.43,750.45,880.87,1014.02,1133.80},
   {389.56,389.46,399.64,428.14,510.92,631.46,751.22,884.78,1020.15,1142.50}},
  {{379.45,379.51,386.50,413.41,489.85,606.79,723.05,849.65,981.88,1099.40},
   {382.55,384.00,393.81,415.33,490.31,609.31,729.92,859.49,994.20,1114.56},
   {394.04,396.84,402.16,430.36,512.82,633.21,752.79,884.01,1018.49,1140.13},
   {374.33,378.99,381.79,414.52,497.10,617.72,737.57,869.67,1005.32,1126.51},
   {398.33,392.61,409.33,435.91,512.24,633.01,752.61,882.45,1015.87,1136.45},
   {394.43,396.83,400.35,434.81,518.75,638.78,757.47,888.12,1020.95,1140.39},
   {383.33,386.92,393.20,447.31,538.36,655.42,768.46,894.57,1019.56,1137.35},
   {395.50,397.59,409.25,436.68,517.24,639.08,759.10,890.36,1025.62,1146.78}},
  {{391.69,396.47,393.26,415.47,485.98,601.99,722.85,852.77,987.83,1112.58},
   {388.78,390.60,403.02,427.80,502.31,619.98,738.14,866.76,999.53,1124.29},
   {400.28,394.13,407.46,431.82,507.75,626.89,748.13,879.86,1016.82,1144.54},
   {406.41,416.82,417.18,442.19,521.57,640.51,758.51,885.99,1016.90,1140.23},
   {404.73,411.82,423.36,446.65,525.82,648.27,769.14,901.50,1037.06,1163.81},
   {403.10,403.49,407.76,436.46,517.31,636.01,755.68,885.72,1019.59,1145.19},
   {384.72,392.48,401.58,425.85,504.32,620.97,741.14,869.74,1003.67,1128.13},
   {404.92,406.60,407.91,442.17,506.76,624.32,742.63,871.42,1005.64,1130.63}},
  {{394.38,396.60,408.70,436.83,522.52,643.62,762.94,894.18,1028.56,1149.56},
   {369.64,368.73,381.69,409.46,492.72,613.05,731.91,862.26,997.73,1118.33},
   {371.73,379.17,385.47,419.90,497.56,617.47,736.87,867.67,1002.45,1122.38},
   {396.95,399.62,407.72,446.63,527.89,646.63,766.29,897.37,1030.74,1150.77},
   {375.84,377.36,386.05,416.59,496.34,615.38,733.39,862.98,997.64,1117.98},
   {385.20,392.04,400.93,430.99,512.66,633.80,752.31,883.52,1018.45,1139.61},
   {388.11,383.27,397.83,426.23,498.15,616.98,735.76,865.52,1001.88,1121.68},
   {380.99,384.43,393.08,415.47,491.06,608.85,727.84,856.01,989.48,1108.24}},
  {{385.28,383.37,390.05,419.70,490.55,608.74,727.68,857.68,993.80,1115.89},
   {379.82,383.31,390.37,409.09,483.67,600.92,718.78,847.40,981.23,1101.46},
   {389.37,396.44,399.87,421.27,490.67,606.07,725.15,853.19,988.64,1109.27},
   {386.06,388.08,389.97,423.15,505.63,625.43,745.19,876.18,1009.82,1131.51},
   {388.92,395.50,395.60,432.70,513.39,633.29,753.67,884.01,1019.37,1142.20},
   {380.10,383.63,391.95,423.46,506.60,627.37,747.49,878.20,1011.77,1133.48},
   {383.02,389.44,393.76,424.15,496.48,615.24,735.11,865.61,1002.22,1124.83},
   {388.98,398.15,405.62,434.05,518.44,639.56,759.83,891.60,1027.96,1149.79}},
  {{391.67,396.49,402.87,432.39,510.74,629.80,749.50,881.49,1017.02,1138.54},
   {416.41,423.07,425.69,454.52,529.46,648.99,767.06,895.87,1027.23,1146.47},
   {384.40,386.17,397.46,422.43,499.06,616.66,734.88,865.71,1000.11,1122.26},
   {387.52,394.31,394.95,429.22,506.50,623.07,742.58,870.56,1003.12,1122.85},
   {396.18,393.29,402.65,430.95,508.85,629.24,750.72,883.05,1017.59,1139.01},
   {387.71,391.50,399.81,426.38,503.12,622.16,740.61,870.84,1004.88,1125.14},
   {421.28,425.02,430.04,457.13,530.95,648.82,768.09,899.37,1032.25,1152.65},
   {392.48,403.23,399.48,427.19,506.53,625.52,745.64,875.64,1010.96,1131.41}},
  {{396.42,400.48,397.58,420.61,499.10,617.57,738.43,868.32,1004.03,1127.24},
   {388.14,386.00,393.38,407.47,483.95,599.63,716.89,844.71,977.35,1097.75},
   {407.56,413.43,414.14,436.49,513.55,630.50,749.35,879.48,1012.94,1135.68},
   {391.84,393.68,398.72,422.49,499.70,615.52,733.25,860.99,995.20,1116.61},
   {403.95,406.00,405.75,428.67,503.32,620.25,741.07,871.32,1006.93,1130.37},
   {404.02,407.26,410.79,438.22,522.50,644.21,764.85,897.00,1033.54,1158.63},
   {387.67,390.70,394.62,418.15,496.39,614.29,734.51,864.37,999.92,1122.59},
   {405.00,404.92,409.84,427.47,508.58,625.89,745.01,873.17,1007.63,1128.85}},
  {{362.16,367.54,384.70,428.73,506.01,624.15,741.50,869.69,1001.39,1115.05},
   {407.25,413.20,427.04,472.87,555.29,673.83,789.82,920.76,1049.77,1162.50},
   {313.56,321.30,336.07,387.36,467.93,585.80,701.03,827.51,957.19,1070.13},
   {374.32,371.27,387.85,425.27,497.24,616.68,736.72,867.75,1003.83,1118.35},
   {375.74,381.98,394.89,436.37,510.85,628.13,749.01,879.91,1015.28,1130.57},
   {354.52,360.83,377.48,418.78,495.07,614.21,734.36,863.95,998.54,1112.04},
   {359.08,362.16,378.03,428.35,508.51,628.78,747.13,874.63,1007.11,1118.70},
   {339.12,343.08,355.66,399.68,471.78,589.62,710.97,839.42,975.43,1087.93}},
  {{649.57,649.48,642.99,653.64,650.20,612.13,732.96,864.18,1001.11,1121.92},
   {648.16,636.41,647.70,637.29,645.96,619.82,740.15,870.97,1007.36,1128.31},
   {654.12,648.63,654.74,651.85,653.79,633.33,753.74,883.00,1017.65,1138.09},
   {695.85,710.55,691.70,692.62,696.65,621.67,742.59,873.12,1008.91,1129.50},
   {712.38,709.45,704.20,703.37,704.48,627.95,748.95,881.01,1017.27,1138.13},
   {719.25,715.45,718.83,718.61,727.13,649.10,770.21,902.43,1038.29,1160.16},
   {650.51,662.64,662.08,660.23,647.63,593.43,713.38,840.50,975.72,1094.11},
   {688.23,681.82,685.42,684.84,695.33,610.87,731.81,862.24,999.49,1119.77}},
  {{401.98,405.84,410.86,431.75,504.87,623.13,740.43,870.91,1005.88,1128.85},//////////////peng
   {398.33,399.94,403.12,426.21,498.73,615.66,734.57,864.62,1000.40,1124.38},
   {393.32,402.02,409.06,430.81,508.44,626.90,743.99,873.33,1006.95,1128.41},
   {406.26,410.15,417.81,446.34,512.51,630.51,751.25,880.76,1013.87,1137.76},
   {387.96,388.65,403.23,419.85,500.18,620.28,741.11,873.81,1011.17,1135.58},
   {396.26,396.57,410.22,431.21,503.10,620.96,741.21,871.18,1005.66,1129.38},
   {403.85,404.46,416.60,438.90,517.90,639.35,759.56,890.83,1024.14,1146.95},
   {404.73,413.75,414.81,441.54,519.72,639.58,760.81,893.10,1030.81,1156.30}},
  {{401.98,405.84,410.86,431.75,504.87,623.13,740.43,870.91,1005.88,1128.85},////peng
   {398.33,399.94,403.12,426.21,498.73,615.66,734.57,864.62,1000.40,1124.38},
   {393.32,402.02,409.06,430.81,508.44,626.90,743.99,873.33,1006.95,1128.41},
   {406.26,410.15,417.81,446.34,512.51,630.51,751.25,880.76,1013.87,1137.76},
   {387.96,388.65,403.23,419.85,500.18,620.28,741.11,873.81,1011.17,1135.58},
   {396.26,396.57,410.22,431.21,503.10,620.96,741.21,871.18,1005.66,1129.38},
   {403.85,404.46,416.60,438.90,517.90,639.35,759.56,890.83,1024.14,1146.95},
   {404.73,413.75,414.81,441.54,519.72,639.58,760.81,893.10,1030.81,1156.30}}
};

*/
/*
int binary(const float *item,int count,float key){
  int low,high,mid;

  if(key<item[0]) return -1;           
  if(key>item[count-1]) return count; 
  low=0;
  high=count-1;
  while(low<=high){
    mid=(low+high) >> 1;
    if(key<item[mid] && key<=item[mid+1]) high=mid-1;
    else if(key>item[mid] && key>=item[mid+1]) low=mid+1;
    else return mid;
  }
  // This is error return, but we don't flag it
  return -1;
}

float rfpower_cal(int nsurf,int nchan,int adc){
  int bin=binary(rfcal[nsurf][nchan],N_DBM,(float)adc);
  if(bin<0) bin=0; // Extrapolate
  else if(bin>=N_DBM) bin=N_DBM-2; // Extrapolate
  float low=rfcal[nsurf][nchan][bin];
  float high=rfcal[nsurf][nchan][bin+1];
  float r=(adc-low)/(high-low);
  return r*(dbm[bin+1]-dbm[bin])+dbm[bin];
}
*/
float slope_yInt[N_SURF][RFCHAN][2]={
{
{ 526.8839104 ,63592.5741 },
{ 373.6863544 ,49897.30734 },
{ 555 ,66666 },
{ 555 ,66666 },
{ 605.3156823 ,73367.47063 },
{ 440.9572301 ,55427.57492 },
{ 555 ,66666 },
{ 590.9572301 ,66656.15929 }
},
{
{ 595.1934827 ,68393.66079 },
{ 594.5417515 ,67800.76056 },
{ 604.3788187 ,70403.7828 },
{ 591.8126273 ,67553.62209 },
{ 614.5213849 ,71506.99889 },
{ 978.1873727 ,96703.62768 },
{ 598.7372709 ,69976.34955 },
{ 532.9327902 ,57954.13249 }
},
{
{ 584.5417515 ,66513.08827 },
{ 604.2362525 ,68788.33899 },
{ 621.6496945 ,71955.98891 },
{ 605.6211813 ,68748.96449 },
{ 590.8757637 ,66758.93426 },
{ 586.700611 ,66010.35153 },
{ 579.6334012 ,68480.18028 },
{ 602.790224 ,67479.39473 }
},
{
{ 606.4765784 ,70179.52729 },
{ 593.0346232 ,67527.59753 },
{ 597.2505092 ,69292.19277 },
{ 605.0916497 ,69221.8018 },
{ 622.1384929 ,72033.83908 },
{ 589.7556008 ,65750.09012 },
{ 606.395112 ,70126.20226 },
{ 595.0305499 ,67003.11073 }
},
{
{ 611.5682281 ,71248.79159 },
{ 590.6517312 ,66357.46543 },
{ 612.2199593 ,69526.29182 },
{ 596.089613 ,68345.13611 },
{ 619.8574338 ,70608.33828 },
{ 622.9531568 ,70848.08937 },
{ 601.0386965 ,68005.85661 },
{ 597.209776 ,66316.28026 }
},
{
{ 609.9592668 ,70866.19727 },
{ 593.1364562 ,67135.92881 },
{ 601.3034623 ,68590.83796 },
{ 383.5845214 ,49567.94835 },
{ 609.0631365 ,70695.02195 },
{ 610.0203666 ,68147.51604 },
{ 599.2668024 ,66867.81223 },
{ 589.2464358 ,66166.73369 }
},
{
{ 594.5824847 ,69710.57308 },
{ 592.7494908 ,66860.20993 },
{ 586.17107943 ,66148.4888 },
{ 624.5621181 ,68524.48369 },
{ 596.3543788 ,69784.31745 },
{ 590.7535642 ,66628.99672 },
{ 570.203666 ,63440.08319 },
{ 594.3584521 ,66476.90425 }
},
{
{ 593.6456212 ,66868.08524 },
{ 582.9327902 ,66069.39395 },
{ 613.3808554 ,71221.14848 },
{ 584.1955193 ,66325.7819 },
{ 593.1364562 ,67137.42881 },
{ 577.9429735 ,65407.36093 },
{ 601.7718941 ,70072.28187 },
{ 595.3971487 ,66276.52336 }
},
{
{ 610.814664 ,70811.96007 },
{ 599.8574338 ,68815.99369 },
{ 621.2423625 ,71470.66377 },
{ 609.2668024 ,68532.08453 },
{ 604.8472505 ,70599.62671 },
{ 598.4317719 ,66513.05569 },
{ 628.3095723 ,72184.93502 },
{ 586.8839104 ,65862.60785 }
},
{
{ 612.586558 ,69577.70445 },
{ 627.2505092 ,70579.90965 },
{ 600.610998 ,70628.52521 },
{ 597.0468432 ,67210.7302 },
{ 600.9368635 ,67894.72533 },
{ 625.1934827 ,68794.47767 },
{ 599.6741344 ,69865.43738 },
{ 578.4521385 ,64953.81736 }
},
{
{ 614.2362525 ,71680.41129 },
{ 626.6191446 ,70426.21567 },
{ 611.4867617 ,70802.06656 },
{ 619.3279022 ,70753.17559 },
{ 609.5315682 ,68567.66587 },
{ 587.5356415 ,66347.30808 },
{ 625.7026477 ,72206.8341 },
{ 550.7739308 ,59571.01381 }
},
{
{ 617.5967413 ,71349.64373 },
{ 605.98778 ,68479.67711 },
{ 615.9063136 ,70013.22438 },
{ 611.2423625 ,69238.19148 },
{ 614.01222 ,71589.34246 },
{ 970.5702648 ,95364.88748 },
{ 598.9205703 ,65651.70586 },
{ 614.5417515 ,68392.80514 }
}
};
/*
  {{501.25,61571},{352.19,48202},{570,65000},{570,65000},{574.57,70943.37},{570,65000},{570,65000},{554.579,63787}},
  {{568.08,66255},{559,64997},{574,68028},{556.69,64783},{583.542,69063},{555.81,63411},{567.47,67510},{501.83,55501}},
  {{550.176,63802.76},{568.336,65957.03},{589.94,69455.235},{569.51,65901.035},{555.557,63973.498},{552.074,63279.475},{549.569,66109},{567.181,64671.07}},
  {{576.51,67816},{558.53,64806},{568.86,67053},{569.75,66434},{590.74,66434},{555.58,63054},{576.94,67803},{560.13,64251}},
  {{581.35,68865},{556.92,63697},{576.81,66733},{562.64,65707},{576.57,67194},{586.18,67948},{565.71,65219},{563.03,63620}},
  {{581.70,68637},{559,64443},{565.77,65788},{458.41,55469},{578.88,68314},{574.14,65318},{563.74,64065},{556.06,63549}},
  {{564.56,67342},{555.77,63943},{555.81,63439},{558.78,63336},{565.51,67352},{553.13,63661},{536.03,60744},{559.86,63756}},
  {{556.77,63959},{545.90,63149},{583.36,68853},{549.62,63599},{556.43,64243},{538.33,62282},{570.74,67625},{559.15,63418}},
  {{581.64,68511},{563.74,65967},{590.92,69079},{573.15,65683},{575.26,68266},{561.72,63617},{649.11,73826},{552.70,63166}},
  {{575.95,66688},{590.23,67660},{571.35,68320},{562.42,64480},{565.32,65085},{581.81,65373},{574.69,67895},{543.42,62191}},
  {{583.48,69255},{602.09,68491},{581.15,68409},{583.79,67950},{573.52,65727},{553.56,63667},{594.68,69758},{519.72,57122}},
  {{586.96,68933},{571.35,65747},{581.60,67307},{576.06,66464},{582.34,69092},{570,65000},{566.34,63082},{578.35,65538}}
};
*/

float rfpower_dBm(int nsurf,int nchan,float adc){
  return (adc-slope_yInt[nsurf][nchan][1])/slope_yInt[nsurf][nchan][0];//Power = (adc-yInt)/slope
}

float rfpower_T(int nsurf,int nchan,float adc){
   float dBm=rfpower_dBm(nsurf,nchan,adc);
   return pow(10,dBm/10.)/1.38*pow(10, 11);// K = {10^(Power/10)}/(1000.*1.38e-23*1e9))
}
/*
float dbmref[N_SURF-2][RFCHAN]={
  {-11.9,-12.2,-10.6,-11.1,-11.8,-11.8,-10.3,-11.6},
  {-13.0,-12.9,-10.5,-10.8,-12.6,-13.0,-10.5,-11.1},
  {-11.8,-12.2,-11.0,-10.4,-12.7,-12.2,-11.0,-10.7},
  {-12.2,-12.8,-11.2,-10.4,-12.2,-13.3,-11.1,-10.4},
  {-12.3,-12.8,-11.6,-11.3,-12.4,-12.9,-11.6,-11.3},
  {-12.5,-13.0,-16.4,-11.0,-12.4,-12.8,-11.4,-11.3},
  {-12.0,-13.6,-11.1, -9.7,-12.4,-13.0,-11.1,-10.3},
  {-12.8,-11.7,-11.0,-10.3,-12.6,-13.4,-11.1,-10.6},
///////////peng////////////////
  {-11.9,-12.2,-10.6,-11.1,-11.8,-11.8,-10.3,-11.6},
  {-13.0,-12.9,-10.5,-10.8,-12.6,-13.0,-10.5,-11.1}
};
///////////////amir's addition////////////////
float temp_ref_old[N_SURF][RFCHAN]={
  {730.25, 753.25, 725.5, 731.5, 863.75, 882.5, 934, 952.75},
  {760.5,760, 742, 785.5, 885.75, 907, 926.25, 933.25},
  {728.25, 721.25, 747.5, 733.5, 899.25, 898.5, 916.75, 930.5},
  {734.5,722.75, 728, 742.5, 903.5, 888.75, 908, 943.75},
  {745.25,724.5, 717.5, 713.75, 896.5, 897, 944.25, 934.5},
  {733.25,726, 727.5, 725.5,	878.25,	891.75,	843, 936},
  {739.5,715.5, 724.75, 775.75, 881.25, 833.25, 907.75, 946},
  {747.5,732.5, 728.25, 735.5, 916, 837.5, 902.25, 910},
  {722.5,703.25, 702.5, 709.5, 846.75, 879.25, 816, 861},
{695.25, 691, 790.75, 732, 917.5, 857, 863.75, 929.75},
///////////////////peng////////////////////////
  {730.25, 753.25, 725.5, 731.5, 863.75, 882.5, 934, 952.75},
  {760.5,760, 742, 785.5, 885.75, 907, 926.25, 933.25}
};
float temp_ref_old2[N_SURF][RFCHAN]={
  {727.487,804.64,724.631,722.329,858.983,877.787,934.749,949},
  {756.501,749.522,737.144,773.222,880.865,903.28,915.262,927.634},
  {725.573,708.625,744.032,730.242,895.187,896.156,916.536,927.695},
  {728.787,711.401,721.548,739.357,898.542,885.401,901.922,936.997},
  {741.744,892.568,715.285,710.484,891.34,716.354,936.81,931.744},
  {727.124,734.478,722.821,721.741,873.294,885.591,902.231,931.522},
  {736.432,711.274,717.305,772.559,882.524,828.922,904.378,949.421},
  {763.697,725.657,723.68, 731.274,910.579,833.934,898.778,903.481},
  {719.72,699.354,699.049,711.522,842.674,872.991,810.827,856.963},
  {692.669,684.882,787.971,727.709,913.597,854.037,861.438,922.79},
//////////////////////////peng///////////////////
  {727.487,804.64,724.631,722.329,858.983,877.787,934.749,949},
  {756.501,749.522,737.144,773.222,880.865,903.28,915.262,927.634}
};

float temp_ref_old3[N_SURF][RFCHAN]={
{730.179,819.236,725.847,723.083,860.013,879.213,935.801,949.894},
{758.512,751.194,738.274,774.513,881.94,904.466,915.743,928.689},
{726.539,710.182,744.859,731.264,896.742,897.032,917.461,928.508},
{726.753,713.457,722.363,740.726,899.923,887.037,902.81,937.976},
{743.04,893.736,715.906,712.134,892.903,718.489,937.719,932.876},
{728.576,736.189,724.073,722.825,874.335,886.835,903.392,932.316},
{738.974,712.985,718.177,774.197,881.927,829.978,905.083,950.85},
{747.937,727.38,724.994,732.67,	912.264,834.968,899.716,904.818},
{721.389,700.395,700.723,712.172,843.668,874.096,811.493,857.978},
{693.361,686.109,789.139,728.906,914.794,855.216,863.644,923.778},
/////////////////////peng////////////////////
{730.179,819.236,725.847,723.083,860.013,879.213,935.801,949.894}
};

float temp_ref_old4[N_SURF][RFCHAN]={
{730.179,819.236,725.847,723.083,860.013,879.213,935.801,949.894},
{758.512,751.194,738.274,774.513,881.94,904.466,915.743,928.689},
{726.539,710.182,744.859,731.264,896.742,897.032,917.461,928.508},
{726.753,713.457,722.363,740.726,899.923,887.037,902.81,937.976},
{743.04,893.736,715.906,712.134,892.903,718.489,937.719,932.876},
{728.576,736.189,724.073,722.825,874.335,886.835,903.392,932.316},
{738.974,712.985,718.177,774.197,881.927,829.978,905.083,950.85},
{747.937,727.38,724.994,732.67,912.264,834.968,899.716,904.818},
{721.389,700.395,700.723,712.172,843.668,874.096,811.493,857.978},
{693.361,686.109,789.139,728.906,914.794,855.216,863.644,923.778},
//////////////////////peng///////////////////
{721.389,700.395,700.723,712.172,843.668,874.096,811.493,857.978},
{693.361,686.109,789.139,728.906,914.794,855.216,863.644,923.778}
};
/////////////////////////////Dec16 2008/////////////////
float temp_ref[N_SURF][RFCHAN]={
{730.179,748.571,725.847,723.083,860.013,879.213,935.801,949.894},
{758.512,751.194,738.274,774.513,881.94,904.466,915.743,928.689},
{726.539,710.182,744.859,731.264,896.742,897.032,917.461,928.508},
{726.753,713.457,722.363,740.726,899.923,887.037,902.81,937.976},
{743.04,893.736,715.906,712.134,892.903,718.489,937.719,932.876},
{766.357,736.189,724.073,722.825,874.335,886.835,903.392,932.316},
{738.974,712.985,718.177,774.197,881.927,829.978,905.083,950.85},
{747.937,727.38,724.994,732.67,912.264,834.968,899.716,904.818},
{721.389,700.395,700.723,712.172,843.668,874.096,811.493,857.978},
{693.361,686.109,789.139,728.906,914.794,855.216,863.644,923.778},
///////////////////////peng/////////////////////
{721.389,700.395,700.723,712.172,843.668,874.096,811.493,857.978},
{693.361,686.109,789.139,728.906,914.794,855.216,863.644,923.778}
};
///////////////////////////////////////////////////////////
float calib_temp_old[N_SURF][RFCHAN]={
{392.47,394.05,	389.62,	396.54,	426.74,	439.8,	444.77,	443.5},
{396.04,390.17,	392.89,	393.58,	438.55,	437.38,	444.87,	446.18},
{393.28,389.36,	397.66,	394.62,	444.56,	429.74,	444.12,	445.15},
{396.54,396.18,	392.15,	395.58,	441.75,	441.63,	444.11,	441.41},
{393.04,433.27,	391.54,	393.67,	437.03,	392.21,	439.44, 443.59},
{392.03,399.54,	391.7,	392.63,	436.15,	432.74,	440.58,	441.44},
{394.91,398.47,	392.92,	394.17,	438.79,	446.59,	438.74,	446.27},
{388.8,	397.21,	390.18,	393.5,	437.24,	455.3,	443.73,	445.54},
{389.02,390.09,	392.66,	391.12,	447.11,	456.55,	453.4,	449.95},
{392.65,387.69,	395.46,	392.3,	453.76,	446.74,	450.01,	449.63},
////////////////////////peng///////////////////////
{389.02,390.09,	392.66,	391.12,	447.11,	456.55,	453.4,	449.95},
{392.65,387.69,	395.46,	392.3,	453.76,	446.74,	450.01,	449.63}
};
/////////////////////////////Dec16 2008/////////////////
float calib_temp[N_SURF][RFCHAN]={
{392.47,394.05,389.62,396.54,426.74,439.8,444.77,443.5},
{396.04,390.17,392.89,393.58,438.55,437.38,444.87,446.18},
{393.28,389.36,397.66,394.62,444.56,429.74,444.12,445.15},
{396.54,396.18,392.15,395.58,441.75,441.63,444.11,441.41},
{393.04,433.27,391.54,393.67,437.03,392.21,439.44,443.59},
{395,399.54,391.7,392.63,436.15,432.74,440.58,441.44},
{394.91,398.47,392.92,394.17,438.79,446.59,438.74,446.27},
{388.8,397.21,390.18,393.5,437.24,455.3,443.73,445.54},
{389.02,390.09,392.66,391.12,447.11,456.55,453.4,449.95},
{392.65,387.69,395.46,392.3,453.76,446.74,450.01,449.63},
//////////////////////////peng//////////////////////////
{389.02,390.09,392.66,391.12,447.11,456.55,453.4,449.95},
{392.65,387.69,395.46,392.3,453.76,446.74,450.01,449.63}
};
//////////////////////////////////////////////////////////
float tref[N_SURF-2][RFCHAN]={
  {450,440,455,446,449,448,448,447},
  {448,450,445,449,434,441,455,446},
  {448,444,446,449,442,444,450,447},
  {444,448,464,453,447,442,450,459},
  {451,438,448,453,442,463,448,445},
  {453,457,572,447,450,440,449,448},
  {446,448,445,459,449,434,448,455},
  {447,458,451,451,444,462,454,449},
///////////////////////peng/////////////////////
  {446,448,445,459,449,434,448,455},
  {447,458,451,451,444,462,454,449}
};
float rfpower_temp(int nsurf,int nchan,float rf){
  if(nsurf>=N_SURF-2)
    return 0;
  else
    return rf/dbmref[nsurf][nchan] * tref[nsurf][nchan] - (tref[nsurf][nchan]-293);
}
float rfpower_temp_anita2(int nsurf,int nchan,int adc){
   float beta=((float)adc)-temp_ref[nsurf][nchan];
   float alpha=(a_temp[nsurf][nchan]*beta)*0.1;
   float rf_pow=(calib_temp[nsurf][nchan]*pow(10,alpha));//in Centigrade
if(nsurf>=N_SURF)
    return 0;
  else
    //  float beta=((float)adc)-temp_ref[nsurf][nchan];
    //  float alpha=(a_temp*beta)*0.1;
    //   float rf_pow=(290*pow(alpha,10))-273.15;//in Centigrade
    return rf_pow;
}
*/

